<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><HTML>
<HEAD>
   <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<STYLE>
BODY,SPAN,TD,P{background-color:#EEEEEE;font-family:Helv,Verdana;font-size:8pt;
     color:#000044;text-align:justify;}
P{text-indent:6px;margin-top:0;}
H4{margin-bottom:6px;}
</STYLE>
<TITLE>Win95Key v3</TITLE>
</HEAD>
<BODY>
<h2>Win95Key v3</h2>
<h3>1. Для чего это программа?</h3>
<p>Данная программа предназначена для назначения действий на нажатие клавиш при
работе с OS/2 PM. В том числе, она позволяет использовать windoze кнопки и
multimedia клавиатуры. Например, вы можете вызывать меню варпцентра при нажатии
на <B>windows</B> кнопку или вызывать Mozilla, используя комбинацию <B>ctrl+shift+m</B>.
Программа написана таким образом, что вы можете легко назначать новые действия
или (если вы разработчик) увеличивать функциональность программы, используя
механизм плагинов. Также, начиная с версии 3, в программу включён пакет <B>kbdfix</B>,
который позволяет использовать кнопки, которые не отдают корректный сканкод
в OS/2 PM и не могут быть использованы в OS/2 стандартными методами.
Например, это кнопка <B>Power</B> и <B>Sleep</B> на современных клавиатурах,
некоторые MultiMedia кнопки.

<h3>2. Установка</h3>
<p>
Для установки программы распакуйте содержимое архива в любую папку, и запустите
REXX скрипт install.cmd, который создаст папку Win95Key на вашем десктопе.
Краткое описание содержимого папки:<br><br>
<TABLE summary="#" cellpadding="3" cellspacing="0" border="0">
<TR>
<TD>"<B>PM Conf Configuration program</B>"</TD>
<td>- PM программа для настройки Win95Key.</td>
</TR>
<TR>
<TD>"<B>Win 95 Key</B>"</TD>
<td> - вот и сама программа ;-)</td>
</TR>
</TR>
<TR>
<TD>"<B>Tools</B>"</TD>
<td> - утилиты, полезные при работе с Win95Key (см. ниже).</td>
</TR>
<TR>
<TD>"<B>src</B>"</TD>
<td> - исходные коды проекта.</td>
</TR>
</TABLE><!-- #  -->
<br>
<span style="color:red;"> Внимание</span> - не рекомендуется ставить Win95Key поверх уже существующей старой
версии, это может привести к проблемам.

<h3>3. Конфигурация</h3>
<p>
Для конфигурации Win95Key запустите программу <B>PM Conf</B>. Это можно сделать из
папки Win95Key или нажав <B>ctrl+shift+s</B> (Win95Key должен быть запущен).
<h4>3.1 Возможности PM Conf</h4>
Программа PM Conf позволяет:
 <ul type="square">
  <li>Показывать назначенные комбинации клавиш, редактировать их и добавлять новые.
  <li> Редактировать параметры плагина назначенного на комбинацию кнопок. При этом описание плагина
       берётся из его ресурсов.
   <li> Поддерживает Drag & Drop (например, в плагине OpenObject)
    <li> Подключать и отключать плагины из внешних библиотек.
    <li> Редактирует и назначает Scan коды cпециальным клавишам (modifiers), например LWIN.
    <li> Выбирать модель клавитауры (файл keyboard.def) для корректного отображения названий расширенных кнопок.
    <li> Перезагружает установки программы Win95Key.
</ul>
<h4>3.2 Добавление событий</h4>
<p>
После запуска программы вы увидите закладку "Hotkeys", в которой можно просматривать список
назначенных комбинаций кнопок и события, которые назначены на них.
<p>
Для добавления новой комбинации нужно:
<ol>
<li>В поле ввода "Code" (скан-код) ввести скан-код клавиши или её название (например  "F").
<li>В поле "Modifiers" (модификаторы) выделить кнопки  с которыми будет работать данная кнопка
    (например, CTRL и Shift). В закладке "Settings" вы можете изменять или добавлять модификаторы. Если
    вы хотите использовать скан-код без модификаторов, то просто не отмечайте модификаторы.
<li>После этого в окне "Plugin" выберите плагин, который вы хотите назначить выбранному сочетанию
   кнопок и нажмите кнопку "Settings". Добавлять или удалять плагины можно в закладке "Settings"
</ol><p>
Для изменения параметров выберите в поле "Hotkey" комбинацию, которую вы хотите изменить, после
этого измените параметры и нажмите кнопку "Change".
<br>
Для удаления комбинации кнопок выберите её в списке "Hotkey" и нажмите кнопку "Remove".
<br>Для того, чтобы Win95Key восприняла сделанные изменения нажмите кнопку "Apply".
<h4>3.3 Добавление/удаленин плагинов</h4>
<p>
Если вы хотите добавить плагин, то для этого необходимо в закладке "Settings" нажать на кнопку "Add
new" в секции plugin. После этого в появившемся диалоге нажмите кнопку "Locate" и в открывшемся
диалоге выберите DLL с плагинами.<p>
В окне "Add plugin" появится список плагинов, которые содержит данная библиотека.
Выберите те плагины, который бы вы хотели установить в систему и нажмите кнопку "Add". После этого
установленные плагины появятся в окне "Function".
<p>
Для удаления плагина выберите его в окне "Function" и нажмите кнопку "Remove"

<h4>3.4 Добавление модификаторов</h4>
<p>
 Секция модификаторы описывает кнопки, которые используются в дополнение стандартным
 модификаторам "Ctrl", "Alt" и "Shift". Для добавления модификатора нажмите в секции "Modifiers" кнопку
 "Add new". После этого введите скан-код модификатора и его название.
 После этого новый модификатор станет доступным в закладке "Hotkeys" при добавлении новых сочетаний
 клавиш.
<br>
    Для удаления или редактирования модификатора выделите его в окошке "Modifiers" и нажмите "Remove"
 или "Edit"
<h4>3.4 Изменение параметров Win95Key</h4>
<p>
  В закладке "Settings" секция global содержит 3 флажка для установки параметров Win95Key.
<br>Флажок "Immediately key reaction" отвечает за срабатывание клавиатуры. Если он установлен, то реакция
происходит сразу после нажатия на установленные кнопки, если снят - то только после их отпускания.
<br>Если установлен флажок "Run minimized" то при следующем запуске Win95Key будет запущен
минимизированным.
<br>Флажок "hide in tasklist" позволяет не показывать Win95Key в списке задач OS/2.
После установки этих параметров необходимо нажать Apply.
<h3>4. Пакет KBDfix</h3>
<p>
Некоторые кнопки на современных клавиатурах не распознаются корректно в OS/2
и не могут быть использованы программой Win95Key (например, кнопки "Power"
и "Sleep"). Для того, чтобы обойти этот баг системы и был написан пакет KBDfix.
<h4>4.1.Определение сканкода "мёртвых кнопок"</h4>
<p>
Если у вас на клавиатуре присутствуют нераспознаваемые программой PM Conf
кнопки которые вы хотите использовать в OS/2, вам необходимо узнать их сканкод,
который возвращает драйвер клавиатуры. Для этого запустите программу
"Keyboard DosMon* tester" из папки Win95Key --> Tools. После запуска программы нажмите
неработоспособные в OS/2 кнопки и запишите их сканкод (scan=xxx). После этого
откройте файл "kbdfixd.cfg" и добавьте строки вида Key=xxx, где xxx - ваш сканкод.
Таких строк может быть сколько угодно. По умолчанию в файле уже есть записи для
кнопок "Power" и "Sleep"
<h4>4.2.Установка демона</h4>
Для того, чтобы пакет KBDfix заработал необходимо прописать его запуск в файле
config.sys.<br>
Для этого добавьте туда строчку вида<pre>
RUN=D:\apps\Win95Key\bin\kbdfixd.exe</pre>
(естественно, путь должен быть указан правильно ;-)) и перезагрузите OS/2.
<h4>4.3.Использование</h4>
После перезагрузки системы клавиши указанные в файле kbdfix.cfg должны
распознаваться корректно. Вы можете изменять конфигурацию KBDFix без
перезагрузки системы - просто отредактируйте файл kbdfix.cfg и вызовите
утилиту "Reload KBDfixD configuration" из папки Win95Key --> Tools.
<br><br>
<span style="color:red">Внимание!</span> Если вам помогла эта утилита - пришлите
ваш файл kbdfix.cfg по адресу <A href="mailto:samm@os2.ru">samm@os2.ru</A>,
в дальнейшем я включу ваши сканкоды в стандартную поставку.
<h3>5. Плагины Win95Key</h3>
В настоящий момент Win95Key содержит в поставке несколько библиотек плагинов.
Библиотека плагинов - это DLL содержащая функции, которые вы можете назначать
как реакцию на нажатия. В этой главе содержится краткое описание плагинов и
примеры использования.
<h4>5.1 Библиотека w95k_std.dll</h3>
<ol>
<li><B>SwitchTo</B> - переключает в указанную задачу. <br>
С помощью данного плагина вы можете вызывать нужное вам окно.
Окна, соответствующие шаблону переключаются циклически.
<br>
Шаблон поиска может быть задан двумя способами:
<ol>
<li> Обычный способ: "string1|string2|string3|string..."
<br>
Ищутся окошки, в заголовке которых есть string1 или string2 или string... .
Если stringI имеет вид: *text то проверяется наличие в заголовке подстроки text.
Если stringI имеет вид: text (первый символ не *) - то проверяется первые символы
заголовка на совпадения с text (те заголовок должен начинаться с этого text)
Ограничение: первый символ string1 не может быть = '/' (почему - смотри пункт 2)

<li>С использованием регулярных выражений: "/string" (шаблон поиска начинается с /).
В этом случае ищутся все заголовки, соответствующие regexp шаблону.
Для реализации регулярных выражений используется библиотека pcre.
</ol>
<li><B>WindowList</B> - вызывает список задач OS/2
<li><B>DesktopMenu</B> - вызывает контекстное меню рабочего стола.
Опциональный параметр - имя рабочего стола.
<li><B>WarpcenterMenu</b> - плагин для управления WarpCenter.<br>
 Данный плагин позволяет с помощью клавиатуры получать доступ к возможностям
 WarpCenter.
 <ul type="square">
 <li>MENU - Вызывает меню WarpCenter "OS/2 Warp"
 <li>WINDOWLIST - Вызывает список окон
 <li>LOCKUP - Вызывает OS/2 Lockup
 <li>FIND - Поиск объектов
 <li>SHUTDOWN - OS/2 Shutdown
 <li>INFO - переключает индикатор WarpCenter
 <li>TRAYS - переключает текущий трей
 <li>CLOCK - переключает часы WarpCenter
 <li>PROPERTIES - вызывает свойства WarpCenter
 </ul>
<li><B>OpenObject</B> - открывает объект WPS или запускает программу.
<br> Вы должны указать имя программы (например, d:\os2\e.exe) или WPS объекта
для открытия (например, "&lt;WP_SYSTEM&gt;"). Также необходимо задать параметры
запуска. Допустимые значения - DEFAULT, HELP, PALETTE, PROMPTDLG, RUNNING,
SETTINGS, TREE, CONTENTS, DETAILS
<li><B>Volume</B> - Управляет главной громкостью. <br>
Необходимо выбрать метод установки громкости (0 - MMOS2 MCI, 1 - LIBMIX PIPE APU, 2 - WPS обьект "Volume")
и указать действие UP (увеличение), DOWN (уменьшение) или MUTE (вкл/выключить).
<li><b>MinimizeAll</b> - сворачивает все окна.<br>
 Вы можете указать (через запятую) список исключений.
</ol>
<h4>5.2 Библиотека w95k_od.dll</h4>
<p><B>SwitchToVirtualDesktop</B> - переключает активный рабочий стол в программе Object Desktop
</BODY></HTML>
<h4>5.3 Библиотека w95k_p.dll</h4>
<p><B>SendToPipe</B> - посылает текст в указанный пользователем PIPE.
<br>С помощью этой программы вы можете легко управлять программами,
поддерживающими PIPE интерфейс. Например,
<A target="_blank" href="http://www.dink.org/z/">Z! mp3 player</A> позволяет
<A target="_blank"  href="http://www.dink.org/z/pipecontrol.htm">управлять
практически всеми своими функциями</A>. Так, чтобы приостановить воспроизведение
mp3 необходимо послать команду "*pause" в PIPE \pipe\zmp3.
<br>В будущем также планируется добавить в эту библиотеку плагин для управления
программой LBMIX.
<h4>5.4 Библиотека w95k_apm.dll</h4>
<p><B>ProcessAPM</B> - управление системой APM в OS/2.<br>
С помощью данного плагина вы можете выключить ваш компьютер (POWER_OFF) или
перевести его в ждущий режим (STANDBY или SUSPEND).
<br> Плагин требует установленных OS/2 APM драйверов (входят в поставку) и
наличия аппаратуры с поддержкой APM.
<h4>5.5 Библиотека w95k_sem.dll</h4>
<p><B>SemPoster</B> - постинг OS/2 event семафора.<br>
Данный плагин посылает OS/2 event семафор с заданным пользователем именем.
Например, он может быть использован для вызова "WarpButton" программы SysTray.
(имя семафора - "\SEM32\SYSTRAY\WARPBTN")
<h3>6. Дополнительные утилиты</h3>
<p>
В папке "Win95Key --> Tools" находятся утилиты полезные при работе с Win95Key.
<br><br>
"<B>Key Info</B>" - отображает сканкод нажатых кнопок, используя OS/2 PM. <br>
"<B>Keyboard DosMon* tester</B>" - отображает сканкод нажатых кнопок, используя функцию DosMonRead.<br>
"<B>Remove win95key &lt;2.xx dll</B>" - удаляет "dll" от старых (0.xx) версий
Win95Key.
<h3>7. Авторы</h3>
Автор программы Win95Key - <A href="mailto:vik@avi.kiev.ua?Subject=w95k;v3">Viktor Remennik</A>.
<br>Автор PM Conf, KBDfix, APM plugin, PIPE Plugin и некоторых дополнений в Win95Key - <A href="mailto:samm@os2.ru">Alex Samorukov</A>
<br>Автор SEM плагина, PCRE switchto плагина и некоторых изменений в Win95Key - <A href="mailto:nickk@nm.ru">nickk</A>
<h3>8. Отдельное спасибо</h3>
Samuel Audet guardia@cam.org for original idea<br>
Dmitry Ban for event processing idea<br>
Sergey Yevtushenko for help with WarpCenter's sizes<br>
Stangl Roman (rstangl@vnet.ibm.com) - за APM/OS2 toolkit.<br>
Vadim Yegorov (vy@org.vrn.ru) - за порт <A href="http://www.vsu.ru/~vy" target="_blank">PCRE</A>.
<h3>9. Список изменений</h3>
Список изменений находится в файле <A href="changelist.txt">changelist.txt</A>
